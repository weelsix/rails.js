!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Rails",[],t):"object"==typeof exports?exports.Rails=t():e.Rails=t()}(this,function(){return function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=function(){function e(t,n){if(a(this,e),this.container=null,this.registered=[],this.urlBase="",this.activePage=null,this.cache=null,t=t||{},this.manageAnchors=t.manageAnchors||!0,this.managePopState=t.managePopState||!0,this.autoClearContainer=t.autoClearContainer||!0,this.containerSelector=t.containerSelector||"#rails-page",this.baseDirectory=t.baseDirectory||"/pages/",this.baseExtension=t.baseExtension||".html",this.cacheDuration=t.cacheDuration||0,this.cacheIsPersistent=t.cacheIsPersistent||!1,this.container=document.querySelectorAll(this.containerSelector)[0],this.cache=new c(this.cacheDuration,this.cacheIsPersistent),!this.container)throw"No valid container";this.manageAnchors&&this.handleAnchors(),this.managePopState&&this._handlePopstate(),"function"==typeof n&&n()}return r(e,[{key:"init",value:function(e,t){var n=this;if(!(t&&t.length>1&&t.match(/^(http|https)\:\/\/([a-zA-z0-9:]+)\/$/i)))throw"Origin must match a correct url pattern";if(this.urlBase=t,"object"!==(void 0===e?"undefined":i(e))||e.length<0)throw"Expected Array as paths list";e.forEach(function(e,t){if("object"!==(void 0===e?"undefined":i(e)))throw"Unable to register a non-object page";n.registerPath(e)}),"/"==document.location.href[document.location.href.length-1]?this.go(e[0].namespace):this.go(document.location.href)}},{key:"go",value:function(e,t){var n=this;void 0===t&&(t=!0);var a=this._parseUrl(e),i=a.page,r=a.parameters,o=!1;if(this.registered.forEach(function(e){e.namespace==i&&(o=e)}),!o)throw"Loading a non register path";if(this.activePage){var s=this.activePage.onLeave();if("function"!=typeof s.then)throw"onLeave function must return a then-able oject, like a Promise or a polyfill"}else var s=new Promise(function(e){e()});var c=this.baseDirectory+o.namespace+this.baseExtension,h=this.cache.getPage(c);Promise.all([s,h]).then(function(e){var a=e[1],s="";s+="<div class='rails-view' data-view='"+o.namespace+"'>",s+=a,s+="</div>",n.autoClearContainer&&(n.container.innerHTML=""),n.container.innerHTML+=s,o.view=document.querySelector('.rails-view[data-view="'+o.namespace+'"]'),o.parameters=r?r.match(o.parametersRegexp):"",o.parametersString=r||"",t&&window.history.pushState({location:i+(r?"/"+r:"")},o.title,n.urlBase+i+(r?"/"+r:"")),n.activePage=o,document.title=n.activePage.title,n.activePage.onEnter()}).catch(function(e){throw e})}},{key:"registerPath",value:function(e){if(void 0===e)throw"Cannot register undefined page";this.registered.push(e)}},{key:"handleAnchors",value:function(e){var t=this;e=e||document;for(var n=e.querySelectorAll("a"),a=0;a<n.length;a++){n[a].addEventListener("click",function(e){t._handleClick(e)},!1)}}},{key:"_parseUrl",value:function(e){var t={page:"",parameters:""};if(e.indexOf("http")>=0||e.indexOf("https")>=0)if(e.indexOf(this.urlBase)>=0){var n=e.match(/(http|https)+:\/\/([a-zA-Z:0-9\.]+)\/([a-zA-Z]+)[\/]?(.*)/i);t.page=n[3],t.parameters=n[4]}else window.open(e);else{var a=e.match(/([a-zA-Z]+)[\/]?(.*)/i);t.page=a[1],t.parameters=a[2]}return t}},{key:"_handleClick",value:function(e){e.preventDefault(),this.go(e.target.href)}},{key:"_handlePopstate",value:function(){var e=this;window.onpopstate=function(t){t.state?e.go(t.state.location,!1):e.go(e.registered[0].namespace)}}}]),e}(),s=function(){function e(){a(this,e),this.view=null,this.namespace="",this.title="",this.parameters=[],this.parametersRegexp=/^(.*)$/i,this.parametersString=""}return r(e,[{key:"onEnter",value:function(){}},{key:"onLeave",value:function(){}}]),e}(),c=function(){function e(t,n){a(this,e),this.duration=t||0,this.persistent=n||!1,this.cache=[],this.persistent&&(this.cache=window.localStorage._railsCache?JSON.parse(window.localStorage._railsCache):[],this.writeInLocalStorage())}return r(e,[{key:"getPage",value:function(e){var t=this;return new Promise(function(n,a){var i=t.getEntry(e);i?n(i.content):window.fetch(e,{method:"get",headers:{"x-rails":"true"}}).then(function(a){a.text().then(function(a){t.duration>0&&t.store({url:e,content:a,time:Date.now()}),n(a)})}).catch(function(e){a(e)})})}},{key:"getEntry",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1,a=0;a<this.cache.length&&!n;a++){var i=this.cache[a];t?i.url==e&&(n=i):i.url==e&&Date.now()-i.time<=this.duration&&(n=i)}return n}},{key:"prefetch",value:function(e){var t=this;window.fetch(e,{method:"get",headers:{"x-rails":"true"}}).then(function(n){n.text().then(function(n){t.duration>0&&t.store({url:e,content:n,time:Date.now()})})}).catch(function(e){throw e})}},{key:"store",value:function(e){var t=this.getEntry(e.url,!0);t?(t.content=e.content,t.time=Date.now()):this.cache.push(e),this.persistent&&this.writeInLocalStorage()}},{key:"writeInLocalStorage",value:function(){window.localStorage._railsCache=JSON.stringify(this.cache)}}]),e}();e.exports={Rails:o,RailsPage:s}}])});